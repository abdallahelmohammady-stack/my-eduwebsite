<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CCE Hub | Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø´Ø§Ù…Ù„</title>
    <link rel="icon" href="favicone.png">
    <!-- Ø®Ø· Cairo -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <!-- Ù…ÙƒØªØ¨Ø© Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* === Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù† === */
        :root {
            --bg-body: #f1f5f9;
            --bg-card: #ffffff;
            --bg-hover: #e0e7ff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --primary: #4f46e5;
            --primary-dark: #3730a3;
            --accent: #06b6d4;
            --danger: #ef4444;
            --border-color: #cbd5e1;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
            --radius: 12px;
            --modal-bg: rgba(15, 23, 42, 0.6);
        }

        /* === Dark Mode === */
        .dark-mode {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --bg-hover: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --accent: #22d3ee;
            --danger: #f87171;
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --modal-bg: rgba(0, 0, 0, 0.8);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        body {
            font-family: 'Cairo', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            line-height: 1.6; min-height: 100vh;
            transition: background-color 0.3s, color 0.3s;
            background-image: radial-gradient(var(--text-secondary) 1px, transparent 1px);
            background-size: 30px 30px; background-color: var(--bg-body);
        }

        /* === Header === */
        header {
            position: sticky; top: 0; z-index: 1000;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border-color); padding: 0.8rem 0; transition: 0.3s;
        }
        .dark-mode header { background: rgba(30, 41, 59, 0.9); }
        .header-content { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.5rem; font-weight: 900; color: var(--primary-dark); cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .logo i { color: var(--accent); }
        .header-actions { display: flex; align-items: center; gap: 15px; }
        .icon-btn { background: var(--bg-card); border: 1px solid var(--border-color); width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-primary); cursor: pointer; transition: 0.3s; }
        .icon-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }
        .search-wrapper { position: relative; width: 100%; max-width: 280px; }
        .search-input { width: 100%; padding: 0.6rem 2.5rem 0.6rem 1rem; background: var(--bg-card); border: 2px solid transparent; border-radius: var(--radius); color: var(--text-primary); font-family: 'Cairo'; font-weight: 600; transition: 0.3s; }
        .search-input:focus { border-color: var(--primary); }
        .search-icon { position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); }

        /* === Views & Cards === */
        main { max-width: 1200px; margin: 2rem auto; padding: 0 1.5rem; min-height: 70vh; }
        .view-section { display: none; animation: fadeIn 0.4s ease-out; }
        .view-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }

        .home-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 1.5rem; margin-top: 2rem; }
        
        /* The Unified Card Style */
        .material-card {
            background: var(--bg-card); border: 1px solid var(--border-color);
            border-radius: var(--radius); padding: 2rem 1.5rem;
            text-align: center; cursor: pointer; transition: all 0.2s ease;
            box-shadow: var(--shadow); position: relative; overflow: hidden;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            height: 100%;
        }
        .material-card:hover { transform: translateY(-4px); border-color: var(--primary); }
        
        /* Icon Container Styling */
        .material-icon {
            width: 60px; height: 60px;
            background: linear-gradient(135deg, var(--bg-body) 0%, #fff 100%);
            color: var(--primary); border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            font-size:1.8rem; margin: 0 auto 1rem;
            border: 2px solid var(--border-color); transition: 0.3s;
            overflow: hidden; /* Important for custom images */
            position: relative;
        }
        .material-card:hover .material-icon { background: var(--primary); color: white; border-color: var(--primary); }
        
        /* Custom Image Styling inside Icon */
        .custom-icon-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        /* When hovering a card with a custom image, keep the image as is or slightly brighten */
        .material-card:hover .custom-icon-img {
            opacity: 0.8;
        }
        
        .material-title { font-size: 1.1rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.3rem; }
        .material-desc { color: var(--text-secondary); font-size: 0.8rem; font-weight: 500; }

        /* Card Actions (Edit/Delete) */
        .card-actions {
            position: absolute; top: 10px; left: 10px; display: flex; gap: 5px;
            opacity: 0; transition: 0.3s; z-index: 2;
        }
        .material-card:hover .card-actions { opacity: 1; }
        
        .action-btn {
            background: var(--bg-card); border: 1px solid var(--border-color);
            width: 28px; height: 28px; border-radius: 6px; display: flex;
            align-items: center; justify-content: center; cursor: pointer;
            color: var(--text-secondary); font-size: 0.8rem;
        }
        .action-btn:hover { color: var(--primary); border-color: var(--primary); }
        .action-btn.delete:hover { color: var(--danger); border-color: var(--danger); }

        /* === Detail View (Unified for All Courses) === */
        .back-btn { background: white; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; margin-bottom: 1.5rem; transition: 0.2s; font-size: 0.9rem; }
        .back-btn:hover { background: var(--primary); color: white; border-color: var(--primary); }

        .detail-header { background: var(--bg-card); padding: 2rem; border-radius: var(--radius); box-shadow: var(--shadow); text-align: center; border: 1px solid var(--border-color); margin-bottom: 2rem; }
        .detail-icon { width: 80px; height: 80px; background: var(--bg-body); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; color: var(--accent); margin: 0 auto 1.5rem; border: 4px solid var(--accent); overflow: hidden;}
        
        /* Detail Custom Image */
        .detail-custom-img {
            width: 100%; height: 100%; object-fit: cover;
        }

        .detail-title { font-size: 2rem; font-weight: 800; color: var(--primary-dark); margin-bottom: 0.5rem; }
        .detail-doc { font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 1.5rem; }
        
        .detail-actions { display: flex; justify-content: center; gap: 10px; }
        .btn-edit-main { background: var(--text-secondary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; display: flex; align-items: center; gap: 5px; }
        .btn-add-link { background: var(--accent); color: white; border: none; padding: 0.5rem 1rem; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; display: flex; align-items: center; gap: 5px; }

        /* Sections List (Chapters) */
        .sections-container { max-width: 800px; margin: 0 auto; }
        .chapter-card { background: var(--bg-card); border-radius: var(--radius); border: 1px solid var(--border-color); overflow: hidden; box-shadow: var(--shadow); margin-bottom: 1.5rem; }
        .chapter-header { background: var(--bg-body); padding: 0.8rem 1rem; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .chapter-title { font-weight: 700; color: var(--primary); font-size: 1rem; }
        .doc-badge { font-size: 0.7rem; background: var(--accent); color: white; padding: 2px 8px; border-radius: 4px; }
        .playlist-list { list-style: none; padding: 0; }
        .track-item { display: flex; align-items: center; padding: 0.7rem 1rem; border-bottom: 1px solid var(--border-color); text-decoration: none; color: var(--text-primary); transition: 0.2s; }
        .track-item:last-child { border-bottom: none; }
        .track-item:hover { background-color: var(--bg-hover); padding-right: 1.2rem; }
        .track-icon { margin-left: 12px; color: var(--text-secondary); }
        .track-item:hover .track-icon { color: var(--primary); }
        .track-info { flex-grow: 1; }
        .track-name { font-weight: 600; font-size: 0.9rem; }
        .go-icon { opacity: 0; color: var(--primary); font-size: 0.8rem; }
        .track-item:hover .go-icon { opacity: 1; }
        
        .delete-track-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; margin-left: 10px; transition: 0.2s; }
        .delete-track-btn:hover { color: var(--danger); }

        /* === Modals & Buttons === */
        .add-course-btn-main {
            background: var(--primary); color: white; border: none;
            padding: 0.8rem 1.5rem; border-radius: var(--radius);
            font-family: 'Cairo'; font-weight: 700; cursor: pointer;
            display: inline-flex; align-items: center; gap: 10px;
            margin: 1rem auto; box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3); transition: 0.3s;
        }
        .add-course-btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(79, 70, 229, 0.4); }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: var(--modal-bg); backdrop-filter: blur(5px); z-index: 2000; display: none; justify-content: center; align-items: center; }
        .modal { background: var(--bg-card); width: 90%; max-width: 450px; padding: 2rem; border-radius: 16px; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2); animation: slideDown 0.3s ease-out; border: 1px solid var(--border-color); }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; }
        .modal-title { font-size: 1.3rem; font-weight: 700; color: var(--primary-dark); }
        .close-modal { background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-secondary); }
        .form-group { margin-bottom: 1rem; }
        .form-label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; }
        .form-input { width: 100%; padding: 0.8rem; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-body); color: var(--text-primary); font-family: 'Cairo'; transition: 0.2s; }
        .form-input:focus { border-color: var(--primary); outline: none; }
        
        /* Icon Upload Specific Styles */
        .icon-upload-wrapper {
            display: flex; align-items: center; gap: 12px;
        }
        .btn-upload-icon {
            background: var(--bg-body); color: var(--text-primary);
            border: 1px dashed var(--border-color); padding: 0.6rem 1rem;
            border-radius: 8px; cursor: pointer; font-family: 'Cairo';
            font-weight: 600; transition: 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .btn-upload-icon:hover { border-color: var(--primary); color: var(--primary); }
        
        #icon-preview {
            width: 50px; height: 50px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--border-color);
            display: none; /* Hidden by default */
            position: relative;
        }
        #icon-preview img { width: 100%; height: 100%; object-fit: cover; }
        
        .modal-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 1.5rem; }
        .btn-cancel { background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; }
        .btn-save { background: var(--primary); color: white; border: none; padding: 0.6rem 1.5rem; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; font-weight: 700; }
        .btn-delete { background: var(--danger); color: white; border: none; padding: 0.6rem 1.2rem; border-radius: 8px; cursor: pointer; font-family: 'Cairo'; font-weight: 600; }

        footer { text-align: center; padding: 2rem; color: var(--text-secondary); font-size: 0.85rem; margin-top: 4rem; border-top: 1px solid var(--border-color); }
        .king-badge { color: #fbbf24; font-size: 0.8rem; margin-left: 5px; }

        @media (max-width: 600px) {
            .home-grid { grid-template-columns: 1fr; }
            .header-content { flex-direction: column; gap: 10px; }
            .search-wrapper { max-width: 100%; width: 100%; }
            .header-actions { width: 100%; justify-content: space-between; }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header>
        <div class="header-content">
            <div class="logo" onclick="showHome()">
                <i class="fa-solid fa-network-wired"></i> CCE Hub
            </div>
            
            <div class="header-actions">
                <button id="theme-toggle" class="icon-btn" title="ØªØºÙŠÙŠØ± Ø§Ù„Ø«ÙŠÙ…">
                    <i class="fa-solid fa-moon"></i>
                </button>
                <div class="search-wrapper">
                    <input type="text" id="searchInput" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø§Ø¯Ø©...">
                    <i class="fa-solid fa-search search-icon"></i>
                </div>
            </div>
        </div>
    </header>

    <main>
        
        <!-- === Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© === -->
        <div id="home-view" class="view-section active">
            <div style="text-align: center; margin-bottom: 2rem;">
                <h1 style="font-size: 2rem; margin-bottom: 0.5rem; color: var(--text-primary);">Ù…ÙƒØªØ¨Ø© Ù‚Ø³Ù… Ù‡Ù†Ø¯Ø³Ø© Ø§Ù„Ø¥ØªØµØ§Ù„Ø§Øª ÙˆØ§Ù„Ø­Ø§Ø³Ø¨Ø§Øª</h1>
                <p style="color: var(--text-secondary); font-size: 0.95rem;">Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙˆØ­Ø¯ Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø¯ (ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ø§Ø¯Ø©)</p>
            </div>

            <div style="text-align: center;">
                <button class="add-course-btn-main" onclick="openCourseModal()">
                    <i class="fa-solid fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯
                </button>
            </div>

            <div class="home-grid" id="course-grid">
                <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±ÙŠØ¨Øª -->
            </div>
        </div>

        <!-- === ØµÙØ­Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ (Dynamic for ALL Courses) === -->
        <div id="detail-view" class="view-section">
            <button class="back-btn" onclick="showHome()">
                <i class="fa-solid fa-arrow-right"></i> Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
            </button>
            
            <div class="detail-header">
                <div class="detail-icon">
                    <div id="detail-icon-container">
                        <!-- Icon or Image will be injected here -->
                        <i id="detail-icon" class="fa-solid fa-book"></i>
                    </div>
                </div>
                <h2 id="detail-title" class="detail-title">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</h2>
                <p id="detail-doc" class="detail-doc">Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ±</p>
                
                <div class="detail-actions">
                    <button class="btn-edit-main" onclick="openEditCourse()">
                        <i class="fa-solid fa-pen"></i> ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø±
                    </button>
                    <button class="btn-add-link" onclick="openLinkModal()">
                        <i class="fa-solid fa-plus"></i> Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· / Ù‚Ø³Ù…
                    </button>
                </div>
            </div>

            <div id="sections-container" class="sections-container">
                <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ù‡Ù†Ø§ -->
            </div>
        </div>

    </main>

    <footer>
        <p>Â© 2026 CCE Hub. Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ÙˆØ­Ø¯.</p>
    </footer>

    <!-- Modal: Course Edit/Create -->
    <div id="course-modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="course-modal-title">Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯</h3>
                <button class="close-modal" onclick="closeCourseModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ù…Ù‚Ø±Ø±</label>
                <input type="text" id="course-name" class="form-input" placeholder="Ù…Ø«Ø§Ù„: ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„ØµÙ„Ø¨Ø©">
            </div>
            <div class="form-group">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø¯ÙƒØªÙˆØ± / Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø©</label>
                <input type="text" id="course-doc" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ø¯ÙƒØªÙˆØ± ÙÙ„Ø§Ù†">
            </div>
            
            <!-- NEW: Icon Upload Section -->
            <div class="form-group">
                <label class="form-label">Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù‚Ø±Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
                <div class="icon-upload-wrapper">
                    <input type="file" id="course-icon-upload" accept="image/png" style="display: none;">
                    <button type="button" class="btn-upload-icon" onclick="document.getElementById('course-icon-upload').click()">
                        <i class="fa-solid fa-image"></i> Ø±ÙØ¹ ØµÙˆØ±Ø© (PNG)
                    </button>
                    <div id="icon-preview">
                        <img id="icon-preview-img" src="" alt="Preview">
                    </div>
                    <span id="upload-hint" style="font-size: 0.75rem; color: var(--text-secondary);">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©</span>
                </div>
            </div>

            <div class="modal-actions">
                <button class="btn-delete" id="btn-delete-course" style="display:none;" onclick="deleteCurrentCourse()">Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø±Ø±</button>
                <div style="flex-grow:1"></div>
                <button class="btn-cancel" onclick="closeCourseModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-save" onclick="saveCourseData()">Ø­ÙØ¸</button>
            </div>
        </div>
    </div>

    <!-- Modal: Add Link -->
    <div id="link-modal-overlay" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø· Ù„Ù„Ù…Ù‚Ø±Ø±</h3>
                <button class="close-modal" onclick="closeLinkModal()">Ã—</button>
            </div>
            <div class="form-group">
                <label class="form-label">Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø· / Ø§Ù„Ù‚Ø³Ù…</label>
                <input type="text" id="link-name" class="form-input" placeholder="Ù…Ø«Ø§Ù„: Ø´Ø§Ø¨ØªØ± 1ØŒ Ø´Ø±Ø­ ÙƒØ§Ù…Ù„">
            </div>
            <div class="form-group">
                <label class="form-label">Ø§Ù„Ø±Ø§Ø¨Ø·</label>
                <input type="url" id="link-url" class="form-input" placeholder="https://...">
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeLinkModal()">Ø¥Ù„ØºØ§Ø¡</button>
                <button class="btn-save" onclick="saveLinkData()">Ø­ÙØ¸ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
            </div>
        </div>
    </div>

    <script>
        // === STATE MANAGEMENT ===
        // Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù…ÙƒØ§Ù† ÙˆØ§Ø­Ø¯ (Original + User Added)
        let allCourses = [
            {
                id: 'math3',
                title: 'Ø±ÙŠØ§Ø¶Ø© 3 ğŸ« ',
                doc: 'D.E & S.V',
                icon: 'fa-calculator',
                sections: [
                    { name: 'Ø¯ÙƒØªÙˆØ± Ø´ÙŠÙ…Ø§Ø¡', badge: 'D.E & S.V', links: [
                        { name: 'Differential Equations', url: 'https://youtube.com/playlist?list=PLDmD18oSY9IDFBY-Cxwov0DdietQdPrwY' },
                        { name: 'S.V (Vector Analysis)', url: 'https://youtube.com/playlist?list=PLDmD18oSY9IBpm38QhF93VM-GeEGNiRKo' }
                    ]},
                    { name: 'Ø¯ÙƒØªÙˆØ± Ø¹Ø¨Ø§Ø³', badge: 'Course', links: [
                        { name: 'Playlist Ø´Ø§Ù…Ù„Ø©', url: 'https://youtube.com/playlist?list=PL1YWN9bMt3OBst07eIJhwj4U256qipeTz' }
                    ]},
                    { name: 'Ø¯ÙƒØªÙˆØ± Ù…ØµØ·ÙÙ‰ Ø§Ù„Ø¹Ø¬Ù…ÙŠ', badge: 'D.E', links: [
                        { name: 'Ø´Ø±Ø­ D.E', url: 'https://youtube.com/playlist?list=PLHAKO34XewLnaahap99m414ntoRGE0lxm' }
                    ]},
                    { name: 'Ø¯ÙƒØªÙˆØ± Ø£Ø­Ù…Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ù„Ù‡', badge: 'S.V', links: [
                        { name: 'Ø´Ø±Ø­ S.V', url: 'https://youtube.com/playlist?list=PLIAuB242F-D6W0jxwDN_OAhXq7H9BhCiL' }
                    ]},
                    { name: 'Ø¯ÙƒØªÙˆØ± Ø£ÙŠÙ…Ù† Ø¬Ù…Ø¹Ø©', badge: 'General', links: [
                        { name: 'Playlist Ø´Ø§Ù…Ù„Ø©', url: 'https://youtube.com/playlist?list=PLtOK4NrEMJsli2gWGs18mdKoYov5MsO_f' }
                    ]},
                    { name: 'Ø¯ÙƒØªÙˆØ± Ù…Ø­Ù…Ø¯ Ø³Ø±ÙˆØ±', badge: 'D.E', links: [
                        { name: 'Ø´Ø±Ø­ D.E', url: 'https://youtube.com/playlist?list=PLfMrPi8g-0mO7SZ0_sCL0AetECNZY6jme' }
                    ]},
                    { name: 'Ø¯ÙƒØªÙˆØ± Ø³Ù…ÙŠØ± Ø´Ù…Ø³ Ø§Ù„Ø¯ÙŠÙ†', badge: 'S.V', links: [
                        { name: 'Ø´Ø±Ø­ S.V', url: 'https://youtube.com/playlist?list=PLfMrPi8g-0mMG-QqK_Xw1o2L1EvyFvRtm' }
                    ]}
                ]
            },
            {
                id: 'logic',
                title: 'Ù„ÙˆØ¬ÙŠÙƒ 1',
                doc: 'Digital Logic',
                icon: 'fa-microchip',
                sections: [
                    { name: 'Ø¯/ Ø£Ø­Ù…Ø¯ ØµØ§Ù„Ø­ ğŸ‘‘', badge: 'King', links: [
                        { name: 'Playlist 1', url: 'https://youtube.com/playlist?list=PL58RkuffQs13k6P5uItCg8nA0Hi3oU2TY' },
                        { name: 'Playlist 2', url: 'https://youtube.com/playlist?list=PLAP4TMOC6CLmThh4UyClRFk0UK5eH8msu' },
                        { name: 'Playlist 3', url: 'https://youtube.com/playlist?list=PLIw7pvqK09TvueRHzvgqFl4l-_MhoE3ep' }
                    ]}
                ]
            },
            {
                id: 'circuits',
                title: 'Ø¯ÙˆØ§Ø¦Ø± ÙƒÙ‡Ø±Ø¨ÙŠØ©',
                doc: 'Electrical Circuits',
                icon: 'fa-plug-circle-bolt',
                sections: [
                    { name: 'Ø¯ ÙŠØ§Ø³Ø± Ø§Ù„Ø¨Ø·Ø§ÙˆÙŠ', badge: 'YouTube', links: [
                        { name: 'Playlist Ø´Ø§Ù…Ù„Ø©', url: 'https://youtube.com/playlist?list=PLka1IWY71Cp_iANs3ir4JjB0bSg8lXTgH' }
                    ]},
                    { name: 'Ø¯. Ù…Ø­Ù…Ø¯ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„', badge: 'AC/DC', links: [
                        { name: 'Ac/Dc 1', url: 'https://youtube.com/playlist?list=PLD30uL4tqplHfK5qBTtU01IARHkBQNiLL' },
                        { name: 'Ac/Dc 2', url: 'https://youtube.com/playlist?list=PLD30uL4tqplG81NNhEGDLiV4YMb3xYBEH' }
                    ]},
                    { name: 'StudyU', badge: 'Channel', links: [
                        { name: 'Ø´Ø±Ø­ Ø§Ù„Ø¯ÙˆØ§Ø¦Ø±', url: 'https://youtube.com/playlist?list=PLkzaiPofN5b1eqFW7wYH8DWx0fAnl3vn4' }
                    ]}
                ]
            },
            {
                id: 'electronics',
                title: 'Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ§Øª',
                doc: 'Electronics',
                icon: 'fa-memory',
                sections: [
                    { name: 'Ø¯/ Ù†ÙŠÙ‡Ø§Ù„', badge: 'Prof', links: [
                        { name: 'Playlist Ø´Ø§Ù…Ù„Ø©', url: 'https://youtube.com/playlist?list=PL3MBZqVIYGpnKfbDRv-WsSqkK_B67TbeQ' }
                    ]}
                ]
            },
            {
                id: 'prob',
                title: 'Ù†Ø¸Ø±ÙŠØ© Ø§Ø­ØªÙ…Ø§Ù„Ø§Øª',
                doc: 'Probability & Stats',
                icon: 'fa-chart-pie',
                sections: [
                    { name: 'Ù…Ù„ÙØ§Øª Ø§Ù„Ø¯ÙƒØªÙˆØ±', badge: 'Drive', links: [
                        { name: 'ÙØªØ­ Ø§Ù„Ù…Ø¬Ù„Ø¯', url: 'https://drive.google.com/drive/folders/1pKkvp1MY38gWNj8Xumpf5o6uvp6wk2M_' }
                    ]}
                ]
            },
            {
                id: 'exams',
                title: 'Ù…Ø³ØªÙˆØ¯Ø¹ Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª',
                doc: 'Archive',
                icon: 'fa-folder-open',
                sections: [
                    { name: 'Ø§Ù„Ø§Ù…ØªØ­Ø§Ù†Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©', badge: 'Exam', links: [
                        { name: 'ÙØªØ­ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹', url: 'https://drive.google.com/folderview?id=1vr4h0p0mhFlJ4p12Vxm1urYIkMAKAG2q' }
                    ]}
                ]
            }
        ];

        let currentCourseId = null;
        let currentIconBase64 = null; // Temporary storage for uploaded icon

        // === LOCAL STORAGE MANAGEMENT ===
        function saveToLocalStorage() {
            try {
                localStorage.setItem('allCourses', JSON.stringify(allCourses));
            } catch (e) {
                alert('ØªÙ†Ø¨ÙŠÙ‡: Ù…Ø³Ø§Ø­Ø© Ø§Ù„ØªØ®Ø²ÙŠÙ† Ù…Ù…ØªÙ„Ø¦Ø©. Ø­Ø§ÙˆÙ„ Ø­Ø°Ù Ø¨Ø¹Ø¶ Ø§Ù„Ù…ÙˆØ§Ø¯ Ø£Ùˆ Ø§Ù„ØµÙˆØ± Ø§Ù„ÙƒØ¨ÙŠØ±Ø©.');
            }
        }

        function loadFromLocalStorage() {
            const storedCourses = localStorage.getItem('allCourses');
            if (storedCourses) {
                allCourses = JSON.parse(storedCourses);
            }
        }

        // === THEME MANAGEMENT ===
        function saveThemeToLocalStorage() {
            const isDarkMode = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        }

        function loadThemeFromLocalStorage() {
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('theme-toggle').querySelector('i').classList.replace('fa-moon', 'fa-sun');
            } else {
                document.body.classList.remove('dark-mode');
                document.getElementById('theme-toggle').querySelector('i').classList.replace('fa-sun', 'fa-moon');
            }
        }

        // === INITIALIZATION ===
        function init() {
            loadThemeFromLocalStorage(); // Load theme on page load
            loadFromLocalStorage(); // Load courses from localStorage
            renderGrid();
            setupImageUploadListener();
        }

        // === RENDERING ===
        function renderGrid() {
            const grid = document.getElementById('course-grid');
            grid.innerHTML = '';

            allCourses.forEach(course => {
                const card = document.createElement('div');
                card.className = 'material-card';
                
                card.onclick = (e) => { 
                    if(!e.target.closest('.card-actions')) openDetail(course.id); 
                };

                // Check if icon is a custom image (Base64) or FontAwesome class
                let iconHTML = '';
                if (course.icon && course.icon.startsWith('data:image')) {
                    iconHTML = `<img src="${course.icon}" class="custom-icon-img" alt="${course.title}">`;
                } else {
                    iconHTML = `<i class="fa-solid ${course.icon}"></i>`;
                }

                card.innerHTML = `
                    <div class="card-actions">
                        <button class="action-btn" onclick="openEditCourseById('${course.id}')" title="ØªØ¹Ø¯ÙŠÙ„"><i class="fa-solid fa-pen"></i></button>
                        <button class="action-btn delete" onclick="deleteCourseById('${course.id}')" title="Ø­Ø°Ù"><i class="fa-solid fa-trash"></i></button>
                    </div>
                    <div class="material-icon">
                        ${iconHTML}
                    </div>
                    <div class="material-title">${course.title}</div>
                    <div class="material-desc">${course.doc}</div>
                `;
                grid.appendChild(card);
            });
        }

        function openDetail(courseId) {
            currentCourseId = courseId;
            const course = allCourses.find(c => c.id === courseId);
            if (!course) return;

            // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ù‡ÙŠØ¯Ø±
            document.getElementById('detail-title').innerText = course.title;
            document.getElementById('detail-doc').innerText = course.doc;
            
            // Handle Detail View Icon (Image vs FontAwesome)
            const iconContainer = document.getElementById('detail-icon-container');
            iconContainer.innerHTML = ''; // Clear existing

            if (course.icon && course.icon.startsWith('data:image')) {
                iconContainer.innerHTML = `<img src="${course.icon}" class="detail-custom-img">`;
                document.querySelector('.detail-icon').style.border = 'none'; // Remove border for image
            } else {
                iconContainer.innerHTML = `<i id="detail-icon" class="fa-solid ${course.icon}"></i>`;
                document.querySelector('.detail-icon').style.border = '4px solid var(--accent)';
            }

            // ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
            const container = document.getElementById('sections-container');
            container.innerHTML = '';

            if (course.sections.length === 0) {
                container.innerHTML = '<div style="text-align:center; color:var(--text-secondary); padding:2rem;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ù‚Ø³Ø§Ù… Ø£Ùˆ Ø±ÙˆØ§Ø¨Ø· Ù…Ø¶Ø§ÙØ©. Ø§Ø¶ØºØ· "Ø¥Ø¶Ø§ÙØ© Ø±Ø§Ø¨Ø·".</div>';
            }

            course.sections.forEach((section, sIndex) => {
                const el = document.createElement('div');
                el.className = 'chapter-card';

                // ØªÙˆÙ„ÙŠØ¯ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø¯Ø§Ø®Ù„ Ø§Ù„Ù‚Ø³Ù…
                let listHTML = '';
                section.links.forEach((link, lIndex) => {
                    listHTML += `
                        <li class="track-item" onclick="window.open('${link.url}', '_blank')">
                            <div class="track-icon"><i class="fa-solid fa-link"></i></div>
                            <div class="track-info"><span class="track-name">${link.name}</span></div>
                            <i class="fa-solid fa-play go-icon"></i>
                            <button class="delete-track-btn" onclick="deleteLink('${course.id}', ${sIndex}, ${lIndex})"><i class="fa-solid fa-trash"></i></button>
                        </li>
                    `;
                });

                el.innerHTML = `
                    <div class="chapter-header">
                        <span class="chapter-title">${section.name}</span>
                        ${section.badge ? `<span class="doc-badge">${section.badge}</span>` : ''}
                        <div style="display: flex; gap: 10px;">
                            <button class="action-btn" onclick="editSectionName('${course.id}', ${sIndex})" title="ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø®Ø§Ù†Ø©"><i class="fa-solid fa-pen"></i></button>
                            <button class="action-btn delete" onclick="deleteSection('${course.id}', ${sIndex})" title="Ø­Ø°Ù Ø§Ù„Ø®Ø§Ù†Ø©"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                    <ul class="playlist-list">
                        ${listHTML}
                    </ul>
                `;
                container.appendChild(el);
            });

            enableDragAndDrop(); // Enable drag-and-drop functionality
            showView('detail-view');
        }

        // === NAVIGATION ===
        function showView(viewId) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(viewId).classList.add('active');
            window.scrollTo(0, 0);
        }
        function showHome() {
            renderGrid();
            showView('home-view');
        }

        // === LOGIC: Icon Detection ===
        function getIcon(name) {
            const n = name.toLowerCase();
            if (n.includes('Ø±ÙŠØ§Ø¶') || n.includes('math')) return 'fa-calculator';
            if (n.includes('ÙÙŠØ²') || n.includes('phys')) return 'fa-bolt';
            if (n.includes('Ø¯Ø§Ø¦Ø±') || n.includes('circ') || n.includes('ÙƒÙ‡Ø±Ø¨')) return 'fa-plug-circle-bolt';
            if (n.includes('Ø¥Ù„ÙƒØªØ±ÙˆÙ†') || n.includes('electr')) return 'fa-memory';
            if (n.includes('Ù„ÙˆØ¬ÙŠÙƒ') || n.includes('log') || n.includes('Ø¨Ø±Ù…Ø¬Ø©') || n.includes('prog')) return 'fa-microchip';
            if (n.includes('Ø§Ø­ØªÙ…Ø§Ù„') || n.includes('stat')) return 'fa-chart-pie';
            if (n.includes('Ø§Ù…ØªØ­Ø§Ù†') || n.includes('exam') || n.includes('Ù…ÙˆØ¯')) return 'fa-file-shield';
            return 'fa-book';
        }

        // === IMAGE UPLOAD HANDLING ===
        function setupImageUploadListener() {
            const input = document.getElementById('course-icon-upload');
            const preview = document.getElementById('icon-preview');
            const previewImg = document.getElementById('icon-preview-img');
            const hint = document.getElementById('upload-hint');

            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    if (file.type !== "image/png") {
                        alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨ØµÙŠØºØ© PNG ÙÙ‚Ø·');
                        input.value = ''; // Reset
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = function(event) {
                        currentIconBase64 = event.target.result;
                        // Show preview
                        previewImg.src = currentIconBase64;
                        preview.style.display = 'block';
                        hint.innerText = 'ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©';
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // === SEARCH ===
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('.material-card').forEach(card => {
                const title = card.querySelector('.material-title').innerText.toLowerCase();
                const desc = card.querySelector('.material-desc').innerText.toLowerCase();
                if(title.includes(term) || desc.includes(term)) {
                    card.style.display = 'flex';
                } else {
                    card.style.display = 'none';
                }
            });
        });

        // === MODALS LOGIC ===
        const courseModal = document.getElementById('course-modal-overlay');
        const linkModal = document.getElementById('link-modal-overlay');

        // 1. Course Modal (Add/Edit)
        function openCourseModal() {
            currentCourseId = null;
            currentIconBase64 = null; // Reset upload state
            
            // Reset UI inputs
            document.getElementById('course-modal-title').innerText = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø±Ø± Ø¬Ø¯ÙŠØ¯';
            document.getElementById('course-name').value = '';
            document.getElementById('course-doc').value = '';
            document.getElementById('btn-delete-course').style.display = 'none';
            
            // Reset Icon Upload UI
            document.getElementById('course-icon-upload').value = '';
            document.getElementById('icon-preview').style.display = 'none';
            document.getElementById('upload-hint').innerText = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©';
            
            courseModal.style.display = 'flex';
        }

        function openEditCourseById(id) {
            event.stopPropagation();
            const course = allCourses.find(c => c.id === id);
            if(!course) return;

            currentCourseId = id;
            currentIconBase64 = null; // Reset upload state (no new image selected yet)

            document.getElementById('course-modal-title').innerText = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ù‚Ø±Ø±';
            document.getElementById('course-name').value = course.title;
            document.getElementById('course-doc').value = course.doc;
            document.getElementById('btn-delete-course').style.display = 'block';

            // Check if existing course has a custom image and show it in preview
            const preview = document.getElementById('icon-preview');
            const previewImg = document.getElementById('icon-preview-img');
            const hint = document.getElementById('upload-hint');

            if (course.icon && course.icon.startsWith('data:image')) {
                // Keep existing image reference in memory until new one is selected
                // We don't set currentIconBase64 here because we only want to update it IF user uploads new one
                previewImg.src = course.icon;
                preview.style.display = 'block';
                hint.innerText = 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© (Ø§Ø¶ØºØ· Ø±ÙØ¹ Ù„ØªØºÙŠÙŠØ±Ù‡Ø§)';
            } else {
                preview.style.display = 'none';
                hint.innerText = 'Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØµÙˆØ±Ø©';
            }

            courseModal.style.display = 'flex';
        }

        function openEditCourse() { // Called from detail view
            openEditCourseById(currentCourseId);
        }

        function closeCourseModal() {
            courseModal.style.display = 'none';
        }

        function saveCourseData() {
            const courseName = document.getElementById('course-name').value.trim();
            const courseDoc = document.getElementById('course-doc').value.trim();

            if (!courseName || !courseDoc) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            if (currentCourseId) {
                // Edit Mode
                const course = allCourses.find(c => c.id === currentCourseId);
                if (course) {
                    course.title = courseName;
                    course.doc = courseDoc;
                    
                    // Only update icon if a new image was uploaded
                    if (currentIconBase64) {
                        course.icon = currentIconBase64;
                    }
                }
            } else {
                // Add Mode
                // Determine icon: use uploaded base64 OR auto-detect based on name
                const iconToUse = currentIconBase64 || getIcon(courseName);

                const newCourse = {
                    id: `course-${Date.now()}`,
                    title: courseName,
                    doc: courseDoc,
                    icon: iconToUse,
                    sections: []
                };
                allCourses.push(newCourse);
            }

            saveToLocalStorage();
            renderGrid();
            closeCourseModal();
        }

        function deleteCurrentCourse() {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø±Ø± ÙˆØ¬Ù…ÙŠØ¹ Ù…Ø­ØªÙˆÙŠØ§ØªÙ‡ØŸ')) {
                deleteCourseById(currentCourseId);
                closeCourseModal();
                showHome();
            }
        }

        function deleteCourseById(id) {
            event.stopPropagation();
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°ÙØŸ')) {
                allCourses = allCourses.filter(c => c.id !== id);
                saveToLocalStorage();
                renderGrid();
            }
        }

        // 2. Link Modal (Add Section)
        function openLinkModal() {
            document.getElementById('link-name').value = '';
            document.getElementById('link-url').value = '';
            linkModal.style.display = 'flex';
        }
        function closeLinkModal() { linkModal.style.display = 'none'; }
        
        function saveLinkData() {
            const name = document.getElementById('link-name').value.trim();
            const url = document.getElementById('link-url').value.trim();

            if (!name || !url) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                return;
            }

            const course = allCourses.find(c => c.id === currentCourseId);
            if (course) {
                // Always create a new section for the new link
                course.sections.push({
                    name: `Ù‚Ø³Ù… Ø¬Ø¯ÙŠØ¯ ${course.sections.length + 1}`,
                    badge: 'Ù…Ø¶Ø§Ù',
                    links: [{ name, url }]
                });
                saveToLocalStorage(); // Save changes to localStorage
                openDetail(course.id); // Refresh the detail view
            }
            closeLinkModal();
        }

        function deleteLink(courseId, sectionIndex, linkIndex) {
            event.stopPropagation();
            const course = allCourses.find(c => c.id === courseId);
            if(course && course.sections[sectionIndex]) {
                if(confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø±Ø§Ø¨Ø·ØŸ')) {
                    course.sections[sectionIndex].links.splice(linkIndex, 1);
                    // If section becomes empty, remove section
                    if(course.sections[sectionIndex].links.length === 0) {
                        course.sections.splice(sectionIndex, 1);
                    }
                    openDetail(courseId);
                }
            }
        }

        // === DELETE SECTION PERMANENTLY ===
        function deleteSection(courseId, sectionIndex) {
            const course = allCourses.find(c => c.id === courseId);
            if (course && course.sections[sectionIndex]) {
                if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø§Ù†Ø©ØŸ')) {
                    course.sections.splice(sectionIndex, 1);
                    saveToLocalStorage(); // Save changes to localStorage
                    openDetail(courseId); // Refresh the detail view
                }
            }
        }

        // === EDIT SECTION NAME ===
        function editSectionName(courseId, sectionIndex) {
            const course = allCourses.find(c => c.id === courseId);
            if (course && course.sections[sectionIndex]) {
                const newName = prompt('Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ø®Ø§Ù†Ø©:', course.sections[sectionIndex].name);
                if (newName) {
                    course.sections[sectionIndex].name = newName.trim();
                    saveToLocalStorage(); // Save changes to localStorage
                    openDetail(courseId); // Refresh the detail view
                }
            }
        }

        // === DRAG AND DROP FOR REORDERING SECTIONS ===
        function enableDragAndDrop() {
            const container = document.getElementById('sections-container');
            const sections = container.querySelectorAll('.chapter-card');

            sections.forEach((section, index) => {
                section.draggable = true;

                section.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', index);
                });

                section.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    section.style.border = '2px dashed var(--primary)';
                });

                section.addEventListener('dragleave', () => {
                    section.style.border = '';
                });

                section.addEventListener('drop', (e) => {
                    e.preventDefault();
                    section.style.border = '';

                    const draggedIndex = e.dataTransfer.getData('text/plain');
                    const targetIndex = index;

                    if (draggedIndex !== targetIndex) {
                        const course = allCourses.find(c => c.id === currentCourseId);
                        if (course) {
                            const [draggedSection] = course.sections.splice(draggedIndex, 1);
                            course.sections.splice(targetIndex, 0, draggedSection);
                            saveToLocalStorage();
                            openDetail(course.id);
                        }
                    }
                });
            });
        }

        // Theme Toggle
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.body.classList.toggle('dark-mode');
            saveThemeToLocalStorage();
        });

        // Close modals on click outside
        [courseModal, linkModal].forEach(m => {
            m.addEventListener('click', (e) => {
                if(e.target === m) m.style.display = 'none';
            });
        });

        // Run
        init();

    </script>
</body>
</html>
